<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[x_shmily]]></title>
  <subtitle><![CDATA[不忘初心，方得始终。]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://datarting.com/"/>
  <updated>2016-01-26T20:41:56.083Z</updated>
  <id>http://datarting.com/</id>
  
  <author>
    <name><![CDATA[x_shmily]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[抓取Kindle电子书销售排行榜]]></title>
    <link href="http://datarting.com/2016/01/26/kindle_book_sort_crawler/"/>
    <id>http://datarting.com/2016/01/26/kindle_book_sort_crawler/</id>
    <published>2016-01-26T14:09:05.000Z</published>
    <updated>2016-01-26T20:41:56.083Z</updated>
    <content type="html"><![CDATA[<p>本程序通过R包XML抓取Kindle电子书销售排行榜，分为付费和免费两类。</p>
<h1 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install.packages(XML)</span><br><span class="line"><span class="keyword">library</span>(XML)</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="u83B7_u53D6_u7F51_u5740"><a href="#u83B7_u53D6_u7F51_u5740" class="headerlink" title="获取网址"></a>获取网址</h1><p>首先获取所需爬取的网址</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page &lt;- <span class="number">1</span>:<span class="number">5</span>     <span class="comment">#总页数</span></span><br><span class="line">urllist &lt;- paste(<span class="string">"http://www.amazon.cn/gp/bestsellers/digital-text/116169071/ref=zg_bs_116169071_pg_"</span>, page, <span class="string">"?ie=UTF8&amp;pg="</span>, page, sep=<span class="string">""</span>)     <span class="comment">#构建每一页网址</span></span><br></pre></td></tr></table></figure>
<p>然后抓取页面，并将其转换为XML格式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webpage &lt;- htmlParse(urllist[<span class="number">1</span>], encoding=<span class="string">"UTF-8"</span>)</span><br><span class="line">pagexml &lt;- xmlRoot(webpage)</span><br></pre></td></tr></table></figure>
<p>此时可以先看一下网页源码的内容，以下为一本书的html源码<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=<span class="string">"zg_item_compact"</span>&gt;</span><br><span class="line">	&lt;div class=<span class="string">"zg_image zg_itemLeftDiv_compact"</span>&gt;</span><br><span class="line">		&lt;div class=<span class="string">"zg_itemImage_compact"</span>&gt;</span><br><span class="line">			&lt;a  href=<span class="string">"http://www.amazon.cn/<span class="variable">%E8</span><span class="variable">%A7</span><span class="variable">%A3</span><span class="variable">%E5</span><span class="variable">%BF</span><span class="variable">%A7</span><span class="variable">%E6</span><span class="variable">%9D</span><span class="variable">%82</span><span class="variable">%E8</span><span class="variable">%B4</span><span class="variable">%A7</span><span class="variable">%E5</span><span class="variable">%BA</span><span class="variable">%97</span>-<span class="variable">%E4</span><span class="variable">%B8</span><span class="variable">%9C</span><span class="variable">%E9</span><span class="variable">%87</span><span class="variable">%8E</span><span class="variable">%E5</span><span class="variable">%9C</span><span class="variable">%AD</span><span class="variable">%E5</span><span class="variable">%90</span><span class="variable">%BE</span>/dp/B00NOQNHP2/ref=zg_bs_116169071_1"</span>&gt;</span><br><span class="line">				&lt;img src=<span class="string">"http://ec4.images-amazon.com/images/I/51F6FK4cLGL._SL160_SL135_.jpg"</span> alt=<span class="string">"解忧杂货店"</span> title=<span class="string">"解忧杂货店"</span> onload=<span class="string">"if (typeof uet == 'function') &#123; uet('af'); &#125;"</span>/&gt;</span><br><span class="line">			&lt;<span class="regexp">/a&gt;</span><br><span class="line">		&lt;/div</span>&gt;</span><br><span class="line">	&lt;<span class="regexp">/div&gt;</span><br><span class="line">&lt;div class="zg_itemRightDiv_compact"&gt;</span><br><span class="line">&lt;div class="zg_rankLine"&gt;</span><br><span class="line">	&lt;span class="zg_rankNumber"&gt;1.&lt;/span</span>&gt;</span><br><span class="line">	&lt;span class=<span class="string">"zg_rankMeta"</span>&gt;&lt;<span class="regexp">/span&gt;</span><br><span class="line">&lt;/div</span>&gt;</span><br><span class="line">&lt;div class=<span class="string">"zg_title"</span>&gt;</span><br><span class="line">	&lt;a  href=<span class="string">"http://www.amazon.cn/<span class="variable">%E8</span><span class="variable">%A7</span><span class="variable">%A3</span><span class="variable">%E5</span><span class="variable">%BF</span><span class="variable">%A7</span><span class="variable">%E6</span><span class="variable">%9D</span><span class="variable">%82</span><span class="variable">%E8</span><span class="variable">%B4</span><span class="variable">%A7</span><span class="variable">%E5</span><span class="variable">%BA</span><span class="variable">%97</span>-<span class="variable">%E4</span><span class="variable">%B8</span><span class="variable">%9C</span><span class="variable">%E9</span><span class="variable">%87</span><span class="variable">%8E</span><span class="variable">%E5</span><span class="variable">%9C</span><span class="variable">%AD</span><span class="variable">%E5</span><span class="variable">%90</span><span class="variable">%BE</span>/dp/B00NOQNHP2/ref=zg_bs_116169071_1"</span>&gt;解忧杂货店&lt;<span class="regexp">/a&gt;</span><br><span class="line">&lt;/div</span>&gt;</span><br><span class="line">&lt;div class=<span class="string">"zg_byline"</span>&gt;~ 东野圭吾 (作者), 李盈春 (译者)&lt;<span class="regexp">/div&gt;</span><br><span class="line">&lt;div class="zg_reviews"&gt;</span><br><span class="line">	&lt;span class="zeitgeistB00NOQNHP2"&gt;</span><br><span class="line">		&lt;span class="a-declarative" data-action="a-popover" data-a-popover="&#123;&amp;quot;closeButton&amp;quot;:&amp;quot;false&amp;quot;,&amp;quot;max-width&amp;quot;:&amp;quot;700&amp;quot;,&amp;quot;position&amp;quot;:&amp;quot;triggerBottom&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;/review</span><span class="regexp">/widgets/average</span>-customer-review/popover/<span class="keyword">ref</span>=acr_zeitgeist__popover?ie=UTF8&amp;amp;asin=B00NOQNHP2&amp;amp;colid=&amp;amp;coliid=&amp;amp;contextId=zeitgeist&amp;amp;<span class="keyword">ref</span>=acr_zeitgeist__popover&amp;quot;&#125;<span class="string">"&gt;</span><br><span class="line">			&lt;a class="</span>a-<span class="keyword">link</span>-normal a-text-normal<span class="string">" href="</span>http:<span class="regexp">//www</span>.amazon.cn/product-reviews/B00NOQNHP2/<span class="keyword">ref</span>=acr_zeitgeist_text?ie=UTF8&amp;showViewpoints=<span class="number">1</span><span class="string">"&gt;</span><br><span class="line">				&lt;i class="</span>a-icon a-icon-star a-star-<span class="number">4</span>-<span class="number">5</span><span class="string">"&gt;</span><br><span class="line">					&lt;span class="</span>a-icon-alt<span class="string">"&gt;平均4.7 星&lt;/span&gt;</span><br><span class="line">				&lt;/i&gt;</span><br><span class="line">			&lt;/a&gt;</span><br><span class="line">		&lt;/span&gt;</span><br><span class="line">		&lt;span class="</span>a-size-small<span class="string">"&gt;</span><br><span class="line">			(&lt;a class="</span>a-<span class="keyword">link</span>-normal<span class="string">" href="</span>http:<span class="regexp">//www</span>.amazon.cn/product-reviews/B00NOQNHP2/<span class="keyword">ref</span>=acr_zeitgeist_text?ie=UTF8&amp;showViewpoints=<span class="number">1</span><span class="string">"&gt;6,905&lt;/a&gt;)</span><br><span class="line">		&lt;/span&gt;</span><br><span class="line">	&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class="</span>zg_availability<span class="string">"&gt;现在可以下载。&lt;/div&gt;</span><br><span class="line">&lt;div class="</span>zg_itemPriceBlock_compact<span class="string">"&gt;</span><br><span class="line">	&lt;strong class="</span>price<span class="string">"&gt;￥ 6.40&lt;/strong&gt; &lt;br /&gt;</span><br><span class="line">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>因为在网页源码中，付费排行和免费排行不是分开的，而是付费免费混排，即112233….的模式。因此为方便起见，先取得奇数和偶数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">odd &lt;- seq(<span class="number">1</span>, <span class="number">40</span>, by = <span class="number">2</span>)  <span class="comment">#奇数</span></span><br><span class="line">even &lt;- seq(<span class="number">2</span>, <span class="number">40</span>, by = <span class="number">2</span>)  <span class="comment">#偶数</span></span><br></pre></td></tr></table></figure>
<h1 id="u6293_u53D6_u4E66_u540D"><a href="#u6293_u53D6_u4E66_u540D" class="headerlink" title="抓取书名"></a>抓取书名</h1><p>从源码里面可以看到书名的标签为<code>&lt;div class=&quot;zg_title&quot;&gt;解忧杂货店&lt;/div&gt;</code>。因此，可以通过“//div [@class=’zg_title’]”来选取，表示选取所有 div元素，且这些元素拥有值为zg_title的class属性。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obtain_name &lt;- <span class="keyword">function</span>(pagexml)&#123;</span><br><span class="line">	bookname &lt;- xpathSApply (pagexml, <span class="string">"//div [@class='zg_title']"</span>, xmlValue)     <span class="comment">#抓取标签内内容</span></span><br><span class="line">	name_pay &lt;- bookname[odd]     <span class="comment">#获取付费排行书名</span></span><br><span class="line">	name_free &lt;- bookname[even]     <span class="comment">#获取免费排行书名</span></span><br><span class="line">	<span class="keyword">return</span>(data.frame(name_pay, name_free))</span><br><span class="line">&#125;</span><br><span class="line">obtain_name(pagexml)$name_pay</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##                                                                                                                                          name_pay</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>                                                                                                                                      解忧杂货店</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>                                                                                                                                    一个人的朝圣</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>                                                                                                                    福尔摩斯探案全集(套装共<span class="number">11</span>册)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>                                                           外国经典原著荟萃（了不起的盖茨比+美妙的新世界+动物庄园+我们+<span class="number">1984</span>）双语版（套装共<span class="number">5</span>册）</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>                                                                                                      自卑与超越：你要清楚自己应该怎样过好这一生</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>                                                    你一定爱读的极简欧洲史（简约不简单的“最短”欧洲史，任志强、钱理群、钱文忠、公孙策联合推荐！）</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>                                                                                                                                      乖，摸摸头</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>                                                                                              你不可错过的<span class="number">32</span>部欧美文学不朽名作 (Fountain·泉系列)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>                                                                                                                                        三体全集</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>                        中国历史那些事儿系列套装：明朝那些事儿（全<span class="number">7</span>册）、这里曾经是汉朝（全<span class="number">6</span>册）、唐史并不如烟（全<span class="number">5</span>册）、如果这是宋史（全<span class="number">10</span>册）</span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>                                                                         无声告白（<span class="number">2014</span>美国亚马逊最佳图书第<span class="number">1</span>名） (读客全球顶级畅销小说文库 <span class="number">218</span>)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>                                                                                                                                         失乐园</span></span><br><span class="line"><span class="preprocessor">## <span class="number">13</span>                                                                                                                                         白夜行</span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>                                                                                                                                     蒋勋说宋词</span></span><br><span class="line"><span class="preprocessor">## <span class="number">15</span>                                                                                                        House of Cards (House of Cards Trilogy)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">16</span> 岛上书店（现象级全球畅销书！美国独立书商选书第<span class="number">1</span>名！每个人的生命中，都有最艰难的那一年，将人生变得美好而辽阔。） (读客全球顶级畅销小说文库 <span class="number">137</span>)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">17</span>                                                                                                                                     追风筝的人</span></span><br><span class="line"><span class="preprocessor">## <span class="number">18</span>                                                                                                                                       未来边缘</span></span><br><span class="line"><span class="preprocessor">## <span class="number">19</span>                                                                               古龙作品文集（大陆唯一合法授权）（精装<span class="number">72</span>册）（读客知识小说文库）</span></span><br><span class="line"><span class="preprocessor">## <span class="number">20</span>                                                                                                                        明朝那些事儿(套装全<span class="number">7</span>册)</span></span><br></pre></td></tr></table></figure>
<p>下面抓取作者、价格、评价以及评价数方法与此类似，直接上代码加注释。</p>
<h1 id="u6293_u53D6_u4F5C_u8005"><a href="#u6293_u53D6_u4F5C_u8005" class="headerlink" title="抓取作者"></a>抓取作者</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">obtain_author &lt;- <span class="keyword">function</span>(pagexml)&#123;</span><br><span class="line">	bookauthor &lt;- xpathSApply (pagexml, <span class="string">"//div [@class='zg_byline']"</span>, xmlValue)</span><br><span class="line">	bookauthor &lt;- sub(<span class="string">"\n\n\n\n\n\n\n~ "</span>, <span class="string">""</span>, bookauthor)     <span class="comment">#sub为字符串替换函数，将抓取出的作者中无效字符删除</span></span><br><span class="line">	author_pay &lt;- bookauthor[odd]     <span class="comment">#获取付费排行作者</span></span><br><span class="line">	author_free &lt;- bookauthor[even]     <span class="comment">#获取免费排行作者</span></span><br><span class="line">	<span class="keyword">return</span>(data.frame(author_pay, author_free))</span><br><span class="line">&#125;</span><br><span class="line">obtain_author(pagexml)$author_pay</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##                                                              author_pay</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>                                        东野圭吾 (作者), 李盈春 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>  蕾秋&lt;U+<span class="number">2022</span>&gt;乔伊斯(Rachel Joyce) 著，黄妙瑜 译 (作者), 黄妙瑜 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>                                      柯南道尔 (Conan Doyle A.) (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>        （美）菲茨杰拉德；赫胥黎；乔治·奥威尔；扎米亚金；奥威尔 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>                         【奥】阿尔弗雷德·阿德勒 (作者), 马晓娜 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>                              约翰&lt;U+<span class="number">2022</span>&gt;赫斯特 (作者), 席玉苹 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>                                                           大冰 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>                                     莎士比亚 等 (作者), 邵明鉴 (编者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>                                                         刘慈欣 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>     当年明月 (作者), 月望东山 (作者), 曲昌春 (作者), 高天流云 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>                伍绮诗 (作者) (作者), 孙璐 (译者) (作者), 孙璐 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>                                       渡边淳一 (作者), 竺家荣 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">13</span>                     东野圭吾 (Higashino Keigo) (作者), 刘姿君 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>                                                          蒋勋 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">15</span>                                                 Michael Dobbs (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">16</span>          加布瑞埃拉&lt;U+<span class="number">2022</span>&gt;泽文 (作者), 孙仲旭 (译者), 李玉瑶 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">17</span>               卡勒德·胡赛尼（Khaled Hosseini） (作者), 李继宏 (译者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">18</span>                                                        刘慈欣 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">19</span>                                                          古龙 (作者)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">20</span>                                                      当年明月 (作者)</span></span><br></pre></td></tr></table></figure>
<h1 id="u6293_u53D6_u4ED8_u8D39_u56FE_u4E66_u4EF7_u683C"><a href="#u6293_u53D6_u4ED8_u8D39_u56FE_u4E66_u4EF7_u683C" class="headerlink" title="抓取付费图书价格"></a>抓取付费图书价格</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">obtain_price &lt;- <span class="keyword">function</span>(pagexml)&#123;</span><br><span class="line">	bookprice &lt;- xpathSApply (pagexml, <span class="string">"//strong [@class='price']"</span>, xmlValue)</span><br><span class="line">	bookprice &lt;- bookprice[odd]     <span class="comment">#去掉免费图书的价格</span></span><br><span class="line">	bookprice &lt;- unlist(strsplit(bookprice,<span class="string">" "</span>))[even]     <span class="comment">#处理数据，去除¥。strsplit为字符串拆分函数，此时以空格拆分字符串</span></span><br><span class="line">	price &lt;- as.numeric(bookprice)     <span class="comment">#转为数字</span></span><br><span class="line">	<span class="keyword">return</span>(price)</span><br><span class="line">&#125;</span><br><span class="line">obtain_price(pagexml)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##  [<span class="number">1</span>]  <span class="number">6.40</span>  <span class="number">0.90</span>  <span class="number">0.99</span>  <span class="number">0.10</span>  <span class="number">0.99</span>  <span class="number">3.99</span>  <span class="number">2.99</span> <span class="number">79.20</span> <span class="number">17.99</span> <span class="number">88.59</span>  <span class="number">8.99</span></span></span><br><span class="line"><span class="preprocessor">## [<span class="number">12</span>]  <span class="number">1.99</span>  <span class="number">8.99</span>  <span class="number">2.99</span>  <span class="number">9.99</span>  <span class="number">8.99</span>  <span class="number">3.99</span>  <span class="number">0.99</span>  <span class="number">4.50</span>  <span class="number">8.99</span></span></span><br></pre></td></tr></table></figure>
<h1 id="u6293_u53D6_u8BC4_u4EF7"><a href="#u6293_u53D6_u8BC4_u4EF7" class="headerlink" title="抓取评价"></a>抓取评价</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">obtain_evaluate &lt;- <span class="keyword">function</span>(pagexml) &#123;</span><br><span class="line">	evaluate &lt;- xpathSApply (pagexml, <span class="string">"//span [@class='a-icon-alt']"</span>, xmlValue)</span><br><span class="line">	evaluate &lt;- sub(<span class="string">"平均"</span>, <span class="string">""</span>, evaluate)     <span class="comment">#处理字符串，删除“平均”</span></span><br><span class="line">	evaluate &lt;- sub(<span class="string">" 星"</span>, <span class="string">""</span>, evaluate)     <span class="comment">#处理字符串，删除“ 星”</span></span><br><span class="line">	evaluate &lt;- as.numeric(evaluate)     <span class="comment">#转为数字</span></span><br><span class="line">	evaluate_pay &lt;- evaluate[odd]     <span class="comment">#获取付费排行评价</span></span><br><span class="line">	evaluate_free &lt;- evaluate[even]     <span class="comment">#获取免费排行评价</span></span><br><span class="line">	<span class="keyword">return</span>(data.frame(evaluate_pay, evaluate_free))</span><br><span class="line">&#125;</span><br><span class="line">obtain_evaluate(pagexml)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##    evaluate_pay evaluate_free</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>           <span class="number">4.7</span>           <span class="number">4.3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>           <span class="number">4.6</span>           <span class="number">4.0</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>           <span class="number">4.2</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>           <span class="number">3.3</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>           <span class="number">4.6</span>           <span class="number">4.3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>           <span class="number">4.4</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>           <span class="number">4.7</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>           <span class="number">4.3</span>           <span class="number">4.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>           <span class="number">4.5</span>           <span class="number">4.5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>          <span class="number">4.0</span>           <span class="number">4.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>          <span class="number">4.6</span>           <span class="number">4.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>          <span class="number">4.5</span>           <span class="number">4.5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">13</span>          <span class="number">4.7</span>           <span class="number">4.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>          <span class="number">4.4</span>           <span class="number">5.0</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">15</span>          <span class="number">4.0</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">16</span>          <span class="number">4.5</span>           <span class="number">4.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">17</span>          <span class="number">4.6</span>           <span class="number">4.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">18</span>          <span class="number">4.4</span>           <span class="number">4.7</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">19</span>          <span class="number">4.7</span>           <span class="number">3.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">20</span>          <span class="number">4.4</span>           <span class="number">4.6</span></span></span><br></pre></td></tr></table></figure>
<h1 id="u6293_u53D6_u8BC4_u4EF7_u6570"><a href="#u6293_u53D6_u8BC4_u4EF7_u6570" class="headerlink" title="抓取评价数"></a>抓取评价数</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">obtain_evaluate_num &lt;- <span class="keyword">function</span>(pagexml)&#123;</span><br><span class="line">	evaluate_num &lt;- xpathSApply (pagexml, <span class="string">"//a [@class='a-link-normal']"</span>, xmlValue)</span><br><span class="line">	evaluate_num &lt;- sub(<span class="string">","</span>, <span class="string">""</span>, evaluate_num)  <span class="comment">#sub为字符串替换函数，将数字中间的逗号(,)替换成空，即删除逗号</span></span><br><span class="line">	evaluate_num &lt;- as.numeric(evaluate_num)  <span class="comment">#转为数字</span></span><br><span class="line">	evaluate_num_pay &lt;- evaluate_num[odd]     <span class="comment">#获取付费排行评价数</span></span><br><span class="line">	evaluate_num_free &lt;- evaluate_num[even]     <span class="comment">#获取免费排行评价数</span></span><br><span class="line">	<span class="keyword">return</span>(data.frame(evaluate_num_pay, evaluate_num_free))</span><br><span class="line">&#125;</span><br><span class="line">obtain_evaluate_num(pagexml)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##    evaluate_num_pay evaluate_num_free</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>              <span class="number">6907</span>              <span class="number">2370</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>              <span class="number">2036</span>               <span class="number">343</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>                <span class="number">71</span>                <span class="number">25</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>                <span class="number">19</span>               <span class="number">737</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>               <span class="number">110</span>              <span class="number">1909</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>              <span class="number">1680</span>               <span class="number">645</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>              <span class="number">4118</span>               <span class="number">852</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>                <span class="number">16</span>               <span class="number">328</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>              <span class="number">1716</span>               <span class="number">434</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>               <span class="number">24</span>               <span class="number">337</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>             <span class="number">1243</span>               <span class="number">818</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>              <span class="number">464</span>               <span class="number">625</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">13</span>             <span class="number">3820</span>               <span class="number">617</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>              <span class="number">133</span>                 <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">15</span>               <span class="number">55</span>               <span class="number">209</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">16</span>             <span class="number">1885</span>               <span class="number">211</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">17</span>            <span class="number">11686</span>               <span class="number">205</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">18</span>              <span class="number">145</span>               <span class="number">346</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">19</span>              <span class="number">135</span>               <span class="number">478</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">20</span>             <span class="number">2344</span>               <span class="number">525</span></span></span><br></pre></td></tr></table></figure>
<h1 id="u4E3B_u7A0B_u5E8F"><a href="#u4E3B_u7A0B_u5E8F" class="headerlink" title="主程序"></a>主程序</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">kindle_pay_sort &lt;- data.frame()     <span class="comment">#产生初始输出数据框</span></span><br><span class="line">kindle_free_sort &lt;- data.frame()</span><br><span class="line">page &lt;- <span class="number">1</span>:<span class="number">5</span></span><br><span class="line">urllist &lt;- paste(<span class="string">"http://www.amazon.cn/gp/bestsellers/digital-text/116169071/ref=zg_bs_116169071_pg_"</span>, page, <span class="string">"?ie=UTF8&amp;pg="</span>, page, sep=<span class="string">""</span>)</span><br><span class="line">odd &lt;- seq(<span class="number">1</span>, <span class="number">40</span>, by = <span class="number">2</span>)  <span class="comment">#奇数</span></span><br><span class="line">even &lt;- seq(<span class="number">2</span>, <span class="number">40</span>, by = <span class="number">2</span>)  <span class="comment">#偶数</span></span><br><span class="line"><span class="keyword">for</span>(URL <span class="keyword">in</span> urllist)&#123;</span><br><span class="line">	webpage &lt;- htmlParse(URL, encoding=<span class="string">"UTF-8"</span>)</span><br><span class="line">	pagexml &lt;- xmlRoot(webpage)</span><br><span class="line">	name &lt;- obtain_name(pagexml)</span><br><span class="line">	author &lt;- obtain_author(pagexml)</span><br><span class="line">	price &lt;- obtain_price(pagexml)</span><br><span class="line">	evaluate &lt;- obtain_evaluate(pagexml)</span><br><span class="line">	evaluate_num &lt;- obtain_evaluate_num(pagexml)</span><br><span class="line">	kindle_pay_sort_pro &lt;- data.frame(name$name_pay, author$author_pay, price, evaluate$evaluate_pay, evaluate_num$evaluate_num_pay)</span><br><span class="line">	kindle_free_sort_pro &lt;- data.frame(name$name_free, author$author_free, evaluate$evaluate_free, evaluate_num$evaluate_num_free)</span><br><span class="line">	kindle_pay_sort &lt;- rbind(kindle_pay_sort, kindle_pay_sort_pro)</span><br><span class="line">	kindle_free_sort &lt;- rbind(kindle_free_sort, kindle_free_sort_pro)</span><br><span class="line">	Sys.sleep(runif(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>))     <span class="comment">#暂停执行一定的时间间隔，防止被amazon识别为机器爬取。runif产生均匀分布随机数</span></span><br><span class="line">&#125;</span><br><span class="line">names(kindle_pay_sort)&lt;-c(<span class="string">"书名"</span>, <span class="string">"作者"</span>, <span class="string">"价格"</span>, <span class="string">"评价"</span>, <span class="string">"评价数"</span>)</span><br><span class="line">names(kindle_free_sort)&lt;-c(<span class="string">"书名"</span>, <span class="string">"作者"</span>, <span class="string">"评价"</span>, <span class="string">"评价数"</span>)</span><br><span class="line">write.csv(kindle_pay_sort,file=<span class="string">"kindle_pay_sort.csv"</span>)</span><br><span class="line">write.csv(kindle_free_sort,file=<span class="string">"kindle_free_sort.csv"</span>)</span><br></pre></td></tr></table></figure>
<p>这样就分别得到了付费排名和免费排名两份文件。如下</p>
<p><img src="http://7xqa0i.com1.z0.glb.clouddn.com/kindle_pay_sort.png" alt="付费排序"><br><img src="http://7xqa0i.com1.z0.glb.clouddn.com/kindle_free_sort.png" alt="免费排序"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>本程序通过R包XML抓取Kindle电子书销售排行榜，分为付费和免费两类。</p>
<h1 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install.packages(XML)</span><br><span class="line"><span class="keyword">library</span>(XML)</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="R" scheme="http://datarting.com/tags/R/"/>
    
      <category term="数据挖掘" scheme="http://datarting.com/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="爬虫" scheme="http://datarting.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="R" scheme="http://datarting.com/categories/R/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[R语言处理缺失数据]]></title>
    <link href="http://datarting.com/2016/01/19/missing_value/"/>
    <id>http://datarting.com/2016/01/19/missing_value/</id>
    <published>2016-01-19T12:55:29.000Z</published>
    <updated>2016-01-20T07:08:21.798Z</updated>
    <content type="html"><![CDATA[<p>在收集的真实数据中，数据缺失是非常常见的现象，而且会对之后的数据分析产生较大影响，因而缺失值的处理是数据预处理的重要内容之一。基本上，缺失数据处理的流程是，首先判断其模式是否随机，然后找出缺失的原因，最后对缺失值进行处理。</p>
<p>这里主要用到VIM和mice包。并利用VIM包里的sleep数据集。<br><a id="more"></a><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.<span class="function"><span class="title">packages</span><span class="params">(c(<span class="string">"VIM"</span>,<span class="string">"mice"</span>)</span></span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="u5224_u65AD_u7F3A_u5931_u6570_u636E"><a href="#u5224_u65AD_u7F3A_u5931_u6570_u636E" class="headerlink" title="判断缺失数据"></a>判断缺失数据</h1><h2 id="u8BC6_u522B_u7F3A_u5931_u503C"><a href="#u8BC6_u522B_u7F3A_u5931_u503C" class="headerlink" title="识别缺失值"></a>识别缺失值</h2><p>R中缺失值以NA表示，判断数据是否存在缺失值的函数有两个is.na()和complete.cases()。</p>
<p>is.na()可以应用于向量、数据框等多种对象，返回逻辑值，若数据为缺失值则返回TRUE，否则为FALSE。</p>
<p>complete.cases()同样返回逻辑值，也可用来可用来识别矩阵或数据框中没有缺失值的行，但值与is.na()相反，缺失值为FALSE，正常数据为TRUE。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data(sleep,package=<span class="string">"VIM"</span>)</span><br><span class="line">is.na(sleep$Dream)</span><br><span class="line">complete.cases(sleep$Dream)</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(is.na(sleep$Dream))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">12</span></span></span><br></pre></td></tr></table></figure>
<p>用以上sum()函数可以知道Dream列一共有12个缺失值。</p>
<h2 id="u4E0D_u540C_u7C7B_u578B_u6570_u636E_u8FD4_u56DE_u503C_u793A_u4F8B"><a href="#u4E0D_u540C_u7C7B_u578B_u6570_u636E_u8FD4_u56DE_u503C_u793A_u4F8B" class="headerlink" title="不同类型数据返回值示例"></a>不同类型数据返回值示例</h2><p>NA：代表缺失值；</p>
<p>NaN：代表不可能的值；</p>
<p>Inf：代表正无穷；</p>
<p>-Inf：代表负无穷。</p>
<p>is.na()：识别缺失值；</p>
<p>is.nan()：识别不可能值；</p>
<p>is.infinite()：无穷值。</p>
<p>is.na()、is.nan()和is.infinite()函数的返回值示例：</p>
<table>
<thead>
<tr>
<th style="text-align:center">x</th>
<th style="text-align:center">is.na()</th>
<th style="text-align:center">is.nan()</th>
<th style="text-align:center">is.infinite()</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">x&lt;-NA</td>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">FALSE</td>
</tr>
<tr>
<td style="text-align:center">x&lt;-0/0</td>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">FALSE</td>
</tr>
<tr>
<td style="text-align:center">x&lt;-1/0</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">TRUE</td>
</tr>
</tbody>
</table>
<h1 id="u5224_u65AD_u7F3A_u5931_u6A21_u5F0F"><a href="#u5224_u65AD_u7F3A_u5931_u6A21_u5F0F" class="headerlink" title="判断缺失模式"></a>判断缺失模式</h1><p>存在缺失数据时，需要进一步判断数据的缺失模式，判断是否是随机的，然后才能确定处理的方法。缺失值从缺失的分布来讲可以分为完全随机缺失，随机缺失和完全非随机缺失。</p>
<p>完全随机缺失(MCAR)指的是数据的缺失是随机的，数据的缺失不依赖于任何不完全变量或完全变量。</p>
<p>随机缺失(MAR)指的是数据的缺失不是完全随机的，即该类数据的缺失依赖于其他完全变量。</p>
<p>完全非随机缺失(MNAR)指的是数据的缺失依赖于不完全变量自身。</p>
<h2 id="u4ECE_u6570_u503C_u89D2_u5EA6"><a href="#u4ECE_u6570_u503C_u89D2_u5EA6" class="headerlink" title="从数值角度"></a>从数值角度</h2><p>可以利用mice包中的md.pattern()函数来判断缺失数据的模式。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(mice)</span><br><span class="line">md.pattern(sleep)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##    BodyWgt BrainWgt Pred Exp Danger Sleep Span Gest Dream NonD   </span></span><br><span class="line"><span class="preprocessor">## <span class="number">42</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>  <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">2</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>  <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">3</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span>  <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">9</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>     <span class="number">0</span>    <span class="number">0</span>  <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">2</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">0</span>    <span class="number">1</span>    <span class="number">1</span>     <span class="number">1</span>    <span class="number">0</span>  <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">1</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span>  <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">2</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">0</span>    <span class="number">1</span>    <span class="number">1</span>     <span class="number">0</span>    <span class="number">0</span>  <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">##  <span class="number">1</span>       <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>     <span class="number">0</span>    <span class="number">0</span>  <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">##          <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span>     <span class="number">4</span>    <span class="number">4</span>    <span class="number">4</span>    <span class="number">12</span>   <span class="number">14</span> <span class="number">38</span></span></span><br></pre></td></tr></table></figure>
<p>“1”表示没有缺失数据，“0”表示存在缺失数据，第一列、最后一列和最后一行分别表示汇总。</p>
<h2 id="u56FE_u5F62_u65B9_u5F0F"><a href="#u56FE_u5F62_u65B9_u5F0F" class="headerlink" title="图形方式"></a>图形方式</h2><p>用图形能更加直观的表示，此时用到VIM包，它实现了缺失模式的可视化，其中包括aggr()、matrixplot()、marginplot()等函数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(VIM)</span><br><span class="line">aggr(sleep)</span><br></pre></td></tr></table></figure>
<p><img src="http://7xqa0i.com1.z0.glb.clouddn.com/R%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE-1.png" alt=""></p>
<p>第一张图显示了各变量缺失数据的比例。第二张图显示了综合的缺失模式，其中红色表示缺失数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matrixplot(sleep)</span><br></pre></td></tr></table></figure>
<p><img src="http://7xqa0i.com1.z0.glb.clouddn.com/R%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE-2.png" alt=""></p>
<p>浅色表示值小，深色表示值大，默认缺失值为红色。</p>
<p>此外，marginplot()函数可生成一幅散点图，在图形边界展示两个变量的缺失值信息。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">marginplot(sleep[c(<span class="string">"Span"</span>,<span class="string">"Dream"</span>)],pch=c(<span class="number">20</span>),col=c(<span class="string">"darkgray"</span>,<span class="string">"red"</span>,<span class="string">"blue"</span>))</span><br></pre></td></tr></table></figure>
<p><img src="http://7xqa0i.com1.z0.glb.clouddn.com/R%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE-3.png" alt=""></p>
<h1 id="u5904_u7406_u7F3A_u5931_u6570_u636E"><a href="#u5904_u7406_u7F3A_u5931_u6570_u636E" class="headerlink" title="处理缺失数据"></a>处理缺失数据</h1><p>处理缺失数据主要有以下三种方法：</p>
<h2 id="u5220_u9664_u7F3A_u5931_u6837_u672C"><a href="#u5220_u9664_u7F3A_u5931_u6837_u672C" class="headerlink" title="删除缺失样本"></a>删除缺失样本</h2><p>过滤掉缺失样本是最简单的方式，但前提是缺失数据的比例较少，且缺失数据是随机出现的，这样删除缺失样本后对分析结果的影响才会不大。</p>
<p>其中可以使用complete.cases()和is.na()选取完整的记录。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dim(sleep)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">62</span> <span class="number">10</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep_1&lt;-sleep[complete.cases(sleep$Dream),]</span><br><span class="line">dim(sleep_1)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">50</span> <span class="number">10</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep_2&lt;-sleep[!is.na(sleep$Dream),]</span><br><span class="line">dim(sleep_2)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">50</span> <span class="number">10</span></span></span><br></pre></td></tr></table></figure>
<p>可以看出，sleep数据集原来有62行，去掉12个Dream缺失后，还剩50行。</p>
<p>对于有多个变量缺失的数据，如果想直接删除所有的缺失值，可以通过na.omit()函数来完成。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep_3&lt;-na.omit(sleep)</span><br><span class="line">dim(sleep_3)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">42</span> <span class="number">10</span></span></span><br></pre></td></tr></table></figure>
<p>去掉所有有缺失值的记录之后，剩下42条完整数据。</p>
<h2 id="u66FF_u6362_u7F3A_u5931_u503C"><a href="#u66FF_u6362_u7F3A_u5931_u503C" class="headerlink" title="替换缺失值"></a>替换缺失值</h2><p>缺失值不一定要完全删除，最常见的是通过赋值来解决，用变量均值或者中位数来替代是常见的做法，这样做的优点在于不会减少样本信息，处理简单，但缺点是当缺失数据不是随机出现时会产生偏差。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep<span class="variable">$Dream</span>[is.na(sleep<span class="variable">$Dream</span>)]&lt;-mean(sleep<span class="variable">$Dream</span>[!is.na(sleep<span class="variable">$Dream</span>)])</span><br><span class="line">sleep<span class="variable">$Dream</span>[is.na(sleep<span class="variable">$Dream</span>)]&lt;-median(sleep<span class="variable">$Dream</span>[!is.na(sleep<span class="variable">$Dream</span>)])</span><br></pre></td></tr></table></figure>
<h2 id="u591A_u91CD_u63D2_u8865_u6CD5"><a href="#u591A_u91CD_u63D2_u8865_u6CD5" class="headerlink" title="多重插补法"></a>多重插补法</h2><p>多重插补(Multiple Imputation)是用于填补复杂数据缺失值的一种方法，该方法通过变量间关系来预测缺失数据，利用蒙特卡洛随机模拟方法生成多个完整数据集，再对这些数据集分别进行分析，最后对这些分析结果进行汇总处理。</p>
<p>其基本思想是对每一个缺失值进行插补，重复m次得到m个插补值，再利用m个插补值估计缺失值。比较有代表性的插补算法有JM模型和FSC(Full Approaches Specification)。</p>
<p>JM模型对原始数据要求很高，需要数据服从多元正态分布。</p>
<p>这里主要介绍FSC方法，因为它的使用对数据分布没有要求，FSC是基于链式方程的插补方法。它与其他多重插补算法的本质区别在于，在进行插补时不必要考虑被插补变量和协变量的联合分布，而是利用单个变量的条件分布逐一进行插补。</p>
<p>R语言中可以通过mice包中的mice()函数可以实现，它随机模拟多个完整数据集存入imp，再对imp进行线性回归，最后利用pool()函数对回归结果汇总。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imp&lt;-mice(sleep,seed=<span class="number">1234</span>)  <span class="comment">#随机模拟数据</span></span><br><span class="line">fit&lt;-with(imp,lm(Dream~Span+Gest))  <span class="comment">#线性回归</span></span><br><span class="line">pooled&lt;-pool(fit)  <span class="comment">#回归结果</span></span><br><span class="line">options(digits = <span class="number">3</span>)  <span class="comment">#显示小数点后三位</span></span><br><span class="line">summary(pooled)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##                  est      se      t   df Pr(&gt;|t|)    lo <span class="number">95</span>     hi <span class="number">95</span> nmis</span></span><br><span class="line"><span class="preprocessor">## (Intercept)  <span class="number">2.54620</span> <span class="number">0.25469</span>  <span class="number">9.997</span> <span class="number">52.1</span> <span class="number">1.02e-13</span>  <span class="number">2.03516</span>  <span class="number">3.057242</span>   NA</span></span><br><span class="line"><span class="preprocessor">## Span        -<span class="number">0.00455</span> <span class="number">0.01204</span> -<span class="number">0.378</span> <span class="number">51.9</span> <span class="number">7.07e-01</span> -<span class="number">0.02871</span>  <span class="number">0.019610</span>    <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## Gest        -<span class="number">0.00392</span> <span class="number">0.00147</span> -<span class="number">2.666</span> <span class="number">55.6</span> <span class="number">1.00e-02</span> -<span class="number">0.00686</span> -<span class="number">0.000973</span>    <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">##                fmi lambda</span></span><br><span class="line"><span class="preprocessor">## (Intercept) <span class="number">0.0871</span> <span class="number">0.0527</span></span></span><br><span class="line"><span class="preprocessor">## Span        <span class="number">0.0886</span> <span class="number">0.0542</span></span></span><br><span class="line"><span class="preprocessor">## Gest        <span class="number">0.0544</span> <span class="number">0.0210</span></span></span><br></pre></td></tr></table></figure>
<p>汇总结果和回归相似，nmis表示变量中缺失数据个数，fmi表示由缺失数据贡献的变异。</p>
<p>imp是一个包含m个插补数据集的列表对象，同时还含有完成插补过程的信息，默认的m=5。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imp</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Multiply imputed data set</span></span><br><span class="line"><span class="preprocessor">## Call:</span></span><br><span class="line"><span class="preprocessor">## mice(data = sleep, seed = <span class="number">1234</span>)</span></span><br><span class="line"><span class="preprocessor">## Number of multiple imputations:  <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## Missing cells per column:</span></span><br><span class="line"><span class="preprocessor">##  BodyWgt BrainWgt     NonD    Dream    Sleep     Span     Gest     Pred </span></span><br><span class="line"><span class="preprocessor">##        <span class="number">0</span>        <span class="number">0</span>       <span class="number">14</span>       <span class="number">12</span>        <span class="number">4</span>        <span class="number">4</span>        <span class="number">4</span>        <span class="number">0</span> </span></span><br><span class="line"><span class="preprocessor">##      Exp   Danger </span></span><br><span class="line"><span class="preprocessor">##        <span class="number">0</span>        <span class="number">0</span> </span></span><br><span class="line"><span class="preprocessor">## Imputation methods:</span></span><br><span class="line"><span class="preprocessor">##  BodyWgt BrainWgt     NonD    Dream    Sleep     Span     Gest     Pred </span></span><br><span class="line"><span class="preprocessor">##       <span class="string">""</span>       <span class="string">""</span>    <span class="string">"pmm"</span>    <span class="string">"pmm"</span>    <span class="string">"pmm"</span>    <span class="string">"pmm"</span>    <span class="string">"pmm"</span>       <span class="string">""</span> </span></span><br><span class="line"><span class="preprocessor">##      Exp   Danger </span></span><br><span class="line"><span class="preprocessor">##       <span class="string">""</span>       <span class="string">""</span> </span></span><br><span class="line"><span class="preprocessor">## VisitSequence:</span></span><br><span class="line"><span class="preprocessor">##  NonD Dream Sleep  Span  Gest </span></span><br><span class="line"><span class="preprocessor">##     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span> </span></span><br><span class="line"><span class="preprocessor">## PredictorMatrix:</span></span><br><span class="line"><span class="preprocessor">##          BodyWgt BrainWgt NonD Dream Sleep Span Gest Pred Exp Danger</span></span><br><span class="line"><span class="preprocessor">## BodyWgt        <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">## BrainWgt       <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">## NonD           <span class="number">1</span>        <span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## Dream          <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>     <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## Sleep          <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>     <span class="number">1</span>     <span class="number">0</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## Span           <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## Gest           <span class="number">1</span>        <span class="number">1</span>    <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span>    <span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## Pred           <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">## Exp            <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">## Danger         <span class="number">0</span>        <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>      <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">## Random generator seed value:  <span class="number">1234</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imp$imp$Dream</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##      <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">1.0</span> <span class="number">0.5</span> <span class="number">0.5</span> <span class="number">0.5</span> <span class="number">0.3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>  <span class="number">2.6</span> <span class="number">2.1</span> <span class="number">1.5</span> <span class="number">1.8</span> <span class="number">1.3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>  <span class="number">3.4</span> <span class="number">3.1</span> <span class="number">3.4</span> <span class="number">1.2</span> <span class="number">3.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span> <span class="number">0.3</span> <span class="number">0.5</span> <span class="number">0.5</span> <span class="number">0.3</span> <span class="number">1.2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">24</span> <span class="number">1.8</span> <span class="number">1.3</span> <span class="number">3.6</span> <span class="number">0.9</span> <span class="number">5.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">26</span> <span class="number">2.3</span> <span class="number">3.1</span> <span class="number">2.0</span> <span class="number">2.6</span> <span class="number">2.1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">30</span> <span class="number">1.2</span> <span class="number">0.3</span> <span class="number">3.4</span> <span class="number">2.6</span> <span class="number">2.3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">31</span> <span class="number">3.4</span> <span class="number">0.5</span> <span class="number">0.6</span> <span class="number">1.0</span> <span class="number">0.5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">47</span> <span class="number">0.5</span> <span class="number">1.5</span> <span class="number">1.5</span> <span class="number">2.2</span> <span class="number">3.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">53</span> <span class="number">0.3</span> <span class="number">0.5</span> <span class="number">0.5</span> <span class="number">0.5</span> <span class="number">0.6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">55</span> <span class="number">0.5</span> <span class="number">0.9</span> <span class="number">2.6</span> <span class="number">2.7</span> <span class="number">2.4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">62</span> <span class="number">1.0</span> <span class="number">2.1</span> <span class="number">0.5</span> <span class="number">3.9</span> <span class="number">3.6</span></span></span><br></pre></td></tr></table></figure>
<p>利用complete()函数可观察m个插补数据集中的任意一个，格式为：complete(imp,action=#)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">complete(imp,action=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##     BodyWgt BrainWgt NonD Dream Sleep  Span  Gest Pred Exp Danger</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">6654.000</span>  <span class="number">5712.00</span>  <span class="number">2.1</span>   <span class="number">0.5</span>   <span class="number">3.3</span>  <span class="number">38.6</span> <span class="number">645.0</span>    <span class="number">3</span>   <span class="number">5</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>     <span class="number">1.000</span>     <span class="number">6.60</span>  <span class="number">6.3</span>   <span class="number">2.0</span>   <span class="number">8.3</span>   <span class="number">4.5</span>  <span class="number">42.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>     <span class="number">3.385</span>    <span class="number">44.50</span> <span class="number">11.0</span>   <span class="number">1.5</span>  <span class="number">12.5</span>  <span class="number">14.0</span>  <span class="number">60.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>     <span class="number">0.920</span>     <span class="number">5.70</span> <span class="number">13.2</span>   <span class="number">3.4</span>  <span class="number">16.5</span>   <span class="number">2.0</span>  <span class="number">25.0</span>    <span class="number">5</span>   <span class="number">2</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>  <span class="number">2547.000</span>  <span class="number">4603.00</span>  <span class="number">2.1</span>   <span class="number">1.8</span>   <span class="number">3.9</span>  <span class="number">69.0</span> <span class="number">624.0</span>    <span class="number">3</span>   <span class="number">5</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>    <span class="number">10.550</span>   <span class="number">179.50</span>  <span class="number">9.1</span>   <span class="number">0.7</span>   <span class="number">9.8</span>  <span class="number">27.0</span> <span class="number">180.0</span>    <span class="number">4</span>   <span class="number">4</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>     <span class="number">0.023</span>     <span class="number">0.30</span> <span class="number">15.8</span>   <span class="number">3.9</span>  <span class="number">19.7</span>  <span class="number">19.0</span>  <span class="number">35.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">160.000</span>   <span class="number">169.00</span>  <span class="number">5.2</span>   <span class="number">1.0</span>   <span class="number">6.2</span>  <span class="number">30.4</span> <span class="number">392.0</span>    <span class="number">4</span>   <span class="number">5</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>     <span class="number">3.300</span>    <span class="number">25.60</span> <span class="number">10.9</span>   <span class="number">3.6</span>  <span class="number">14.5</span>  <span class="number">28.0</span>  <span class="number">63.0</span>    <span class="number">1</span>   <span class="number">2</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>   <span class="number">52.160</span>   <span class="number">440.00</span>  <span class="number">8.3</span>   <span class="number">1.4</span>   <span class="number">9.7</span>  <span class="number">50.0</span> <span class="number">230.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>    <span class="number">0.425</span>     <span class="number">6.40</span> <span class="number">11.0</span>   <span class="number">1.5</span>  <span class="number">12.5</span>   <span class="number">7.0</span> <span class="number">112.0</span>    <span class="number">5</span>   <span class="number">4</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>  <span class="number">465.000</span>   <span class="number">423.00</span>  <span class="number">3.2</span>   <span class="number">0.7</span>   <span class="number">3.9</span>  <span class="number">30.0</span> <span class="number">281.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">13</span>    <span class="number">0.550</span>     <span class="number">2.40</span>  <span class="number">7.6</span>   <span class="number">2.7</span>  <span class="number">10.3</span>  <span class="number">18.0</span>  <span class="number">46.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>  <span class="number">187.100</span>   <span class="number">419.00</span>  <span class="number">3.3</span>   <span class="number">0.5</span>   <span class="number">3.1</span>  <span class="number">40.0</span> <span class="number">365.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">15</span>    <span class="number">0.075</span>     <span class="number">1.20</span>  <span class="number">6.3</span>   <span class="number">2.1</span>   <span class="number">8.4</span>   <span class="number">3.5</span>  <span class="number">42.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">16</span>    <span class="number">3.000</span>    <span class="number">25.00</span>  <span class="number">8.6</span>   <span class="number">0.0</span>   <span class="number">8.6</span>  <span class="number">50.0</span>  <span class="number">28.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">17</span>    <span class="number">0.785</span>     <span class="number">3.50</span>  <span class="number">6.6</span>   <span class="number">4.1</span>  <span class="number">10.7</span>   <span class="number">6.0</span>  <span class="number">42.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">18</span>    <span class="number">0.200</span>     <span class="number">5.00</span>  <span class="number">9.5</span>   <span class="number">1.2</span>  <span class="number">10.7</span>  <span class="number">10.4</span> <span class="number">120.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">19</span>    <span class="number">1.410</span>    <span class="number">17.50</span>  <span class="number">4.8</span>   <span class="number">1.3</span>   <span class="number">6.1</span>  <span class="number">34.0</span>  <span class="number">28.0</span>    <span class="number">1</span>   <span class="number">2</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">20</span>   <span class="number">60.000</span>    <span class="number">81.00</span> <span class="number">12.0</span>   <span class="number">6.1</span>  <span class="number">18.1</span>   <span class="number">7.0</span>  <span class="number">21.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">21</span>  <span class="number">529.000</span>   <span class="number">680.00</span> <span class="number">11.0</span>   <span class="number">0.3</span>  <span class="number">10.8</span>  <span class="number">28.0</span> <span class="number">400.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">22</span>   <span class="number">27.660</span>   <span class="number">115.00</span>  <span class="number">3.3</span>   <span class="number">0.5</span>   <span class="number">3.8</span>  <span class="number">20.0</span> <span class="number">148.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">23</span>    <span class="number">0.120</span>     <span class="number">1.00</span> <span class="number">11.0</span>   <span class="number">3.4</span>  <span class="number">14.4</span>   <span class="number">3.9</span>  <span class="number">16.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">24</span>  <span class="number">207.000</span>   <span class="number">406.00</span>  <span class="number">8.2</span>   <span class="number">3.6</span>  <span class="number">12.0</span>  <span class="number">39.3</span> <span class="number">252.0</span>    <span class="number">1</span>   <span class="number">4</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">25</span>   <span class="number">85.000</span>   <span class="number">325.00</span>  <span class="number">4.7</span>   <span class="number">1.5</span>   <span class="number">6.2</span>  <span class="number">41.0</span> <span class="number">310.0</span>    <span class="number">1</span>   <span class="number">3</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">26</span>   <span class="number">36.330</span>   <span class="number">119.50</span> <span class="number">11.0</span>   <span class="number">2.0</span>  <span class="number">13.0</span>  <span class="number">16.2</span>  <span class="number">63.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">27</span>    <span class="number">0.101</span>     <span class="number">4.00</span> <span class="number">10.4</span>   <span class="number">3.4</span>  <span class="number">13.8</span>   <span class="number">9.0</span>  <span class="number">28.0</span>    <span class="number">5</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">28</span>    <span class="number">1.040</span>     <span class="number">5.50</span>  <span class="number">7.4</span>   <span class="number">0.8</span>   <span class="number">8.2</span>   <span class="number">7.6</span>  <span class="number">68.0</span>    <span class="number">5</span>   <span class="number">3</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">29</span>  <span class="number">521.000</span>   <span class="number">655.00</span>  <span class="number">2.1</span>   <span class="number">0.8</span>   <span class="number">2.9</span>  <span class="number">46.0</span> <span class="number">336.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">30</span>  <span class="number">100.000</span>   <span class="number">157.00</span>  <span class="number">7.4</span>   <span class="number">3.4</span>  <span class="number">10.8</span>  <span class="number">22.4</span> <span class="number">100.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">31</span>   <span class="number">35.000</span>    <span class="number">56.00</span>  <span class="number">3.3</span>   <span class="number">0.6</span>   <span class="number">3.8</span>  <span class="number">16.3</span>  <span class="number">33.0</span>    <span class="number">3</span>   <span class="number">5</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">32</span>    <span class="number">0.005</span>     <span class="number">0.14</span>  <span class="number">7.7</span>   <span class="number">1.4</span>   <span class="number">9.1</span>   <span class="number">2.6</span>  <span class="number">21.5</span>    <span class="number">5</span>   <span class="number">2</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">33</span>    <span class="number">0.010</span>     <span class="number">0.25</span> <span class="number">17.9</span>   <span class="number">2.0</span>  <span class="number">19.9</span>  <span class="number">24.0</span>  <span class="number">50.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">34</span>   <span class="number">62.000</span>  <span class="number">1320.00</span>  <span class="number">6.1</span>   <span class="number">1.9</span>   <span class="number">8.0</span> <span class="number">100.0</span> <span class="number">267.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">35</span>    <span class="number">0.122</span>     <span class="number">3.00</span>  <span class="number">8.2</span>   <span class="number">2.4</span>  <span class="number">10.6</span>  <span class="number">12.7</span>  <span class="number">30.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">36</span>    <span class="number">1.350</span>     <span class="number">8.10</span>  <span class="number">8.4</span>   <span class="number">2.8</span>  <span class="number">11.2</span>   <span class="number">4.5</span>  <span class="number">45.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">37</span>    <span class="number">0.023</span>     <span class="number">0.40</span> <span class="number">11.9</span>   <span class="number">1.3</span>  <span class="number">13.2</span>   <span class="number">3.2</span>  <span class="number">19.0</span>    <span class="number">4</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">38</span>    <span class="number">0.048</span>     <span class="number">0.33</span> <span class="number">10.8</span>   <span class="number">2.0</span>  <span class="number">12.8</span>   <span class="number">2.0</span>  <span class="number">30.0</span>    <span class="number">4</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">39</span>    <span class="number">1.700</span>     <span class="number">6.30</span> <span class="number">13.8</span>   <span class="number">5.6</span>  <span class="number">19.4</span>   <span class="number">5.0</span>  <span class="number">12.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">40</span>    <span class="number">3.500</span>    <span class="number">10.80</span> <span class="number">14.3</span>   <span class="number">3.1</span>  <span class="number">17.4</span>   <span class="number">6.5</span> <span class="number">120.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">41</span>  <span class="number">250.000</span>   <span class="number">490.00</span>  <span class="number">7.7</span>   <span class="number">1.0</span>   <span class="number">8.4</span>  <span class="number">23.6</span> <span class="number">440.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">42</span>    <span class="number">0.480</span>    <span class="number">15.50</span> <span class="number">15.2</span>   <span class="number">1.8</span>  <span class="number">17.0</span>  <span class="number">12.0</span> <span class="number">140.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">43</span>   <span class="number">10.000</span>   <span class="number">115.00</span> <span class="number">10.0</span>   <span class="number">0.9</span>  <span class="number">10.9</span>  <span class="number">20.2</span> <span class="number">170.0</span>    <span class="number">4</span>   <span class="number">4</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">44</span>    <span class="number">1.620</span>    <span class="number">11.40</span> <span class="number">11.9</span>   <span class="number">1.8</span>  <span class="number">13.7</span>  <span class="number">13.0</span>  <span class="number">17.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">45</span>  <span class="number">192.000</span>   <span class="number">180.00</span>  <span class="number">6.5</span>   <span class="number">1.9</span>   <span class="number">8.4</span>  <span class="number">27.0</span> <span class="number">115.0</span>    <span class="number">4</span>   <span class="number">4</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">46</span>    <span class="number">2.500</span>    <span class="number">12.10</span>  <span class="number">7.5</span>   <span class="number">0.9</span>   <span class="number">8.4</span>  <span class="number">18.0</span>  <span class="number">31.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">47</span>    <span class="number">4.288</span>    <span class="number">39.20</span> <span class="number">11.0</span>   <span class="number">1.5</span>  <span class="number">12.5</span>  <span class="number">13.7</span>  <span class="number">63.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">48</span>    <span class="number">0.280</span>     <span class="number">1.90</span> <span class="number">10.6</span>   <span class="number">2.6</span>  <span class="number">13.2</span>   <span class="number">4.7</span>  <span class="number">21.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">49</span>    <span class="number">4.235</span>    <span class="number">50.40</span>  <span class="number">7.4</span>   <span class="number">2.4</span>   <span class="number">9.8</span>   <span class="number">9.8</span>  <span class="number">52.0</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">50</span>    <span class="number">6.800</span>   <span class="number">179.00</span>  <span class="number">8.4</span>   <span class="number">1.2</span>   <span class="number">9.6</span>  <span class="number">29.0</span> <span class="number">164.0</span>    <span class="number">2</span>   <span class="number">3</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">51</span>    <span class="number">0.750</span>    <span class="number">12.30</span>  <span class="number">5.7</span>   <span class="number">0.9</span>   <span class="number">6.6</span>   <span class="number">7.0</span> <span class="number">225.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">52</span>    <span class="number">3.600</span>    <span class="number">21.00</span>  <span class="number">4.9</span>   <span class="number">0.5</span>   <span class="number">5.4</span>   <span class="number">6.0</span> <span class="number">225.0</span>    <span class="number">3</span>   <span class="number">2</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">53</span>   <span class="number">14.830</span>    <span class="number">98.20</span>  <span class="number">2.1</span>   <span class="number">0.5</span>   <span class="number">2.6</span>  <span class="number">17.0</span> <span class="number">150.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">54</span>   <span class="number">55.500</span>   <span class="number">175.00</span>  <span class="number">3.2</span>   <span class="number">0.6</span>   <span class="number">3.8</span>  <span class="number">20.0</span> <span class="number">151.0</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">55</span>    <span class="number">1.400</span>    <span class="number">12.50</span>  <span class="number">8.4</span>   <span class="number">2.6</span>  <span class="number">11.0</span>  <span class="number">12.7</span>  <span class="number">90.0</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">56</span>    <span class="number">0.060</span>     <span class="number">1.00</span>  <span class="number">8.1</span>   <span class="number">2.2</span>  <span class="number">10.3</span>   <span class="number">3.5</span> <span class="number">100.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">57</span>    <span class="number">0.900</span>     <span class="number">2.60</span> <span class="number">11.0</span>   <span class="number">2.3</span>  <span class="number">13.3</span>   <span class="number">4.5</span>  <span class="number">60.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">58</span>    <span class="number">2.000</span>    <span class="number">12.30</span>  <span class="number">4.9</span>   <span class="number">0.5</span>   <span class="number">5.4</span>   <span class="number">7.5</span> <span class="number">200.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">59</span>    <span class="number">0.104</span>     <span class="number">2.50</span> <span class="number">13.2</span>   <span class="number">2.6</span>  <span class="number">15.8</span>   <span class="number">2.3</span>  <span class="number">46.0</span>    <span class="number">3</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">60</span>    <span class="number">4.190</span>    <span class="number">58.00</span>  <span class="number">9.7</span>   <span class="number">0.6</span>  <span class="number">10.3</span>  <span class="number">24.0</span> <span class="number">210.0</span>    <span class="number">4</span>   <span class="number">3</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">61</span>    <span class="number">3.500</span>     <span class="number">3.90</span> <span class="number">12.8</span>   <span class="number">6.6</span>  <span class="number">19.4</span>   <span class="number">3.0</span>  <span class="number">14.0</span>    <span class="number">2</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">62</span>    <span class="number">4.050</span>    <span class="number">17.00</span> <span class="number">17.9</span>   <span class="number">0.5</span>  <span class="number">19.4</span>  <span class="number">13.0</span>  <span class="number">38.0</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br></pre></td></tr></table></figure>
<p>下面手动将预测结果计算出来，并补全数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data.pre&lt;-sleep[is.na(sleep$Dream),][,<span class="number">6</span>:<span class="number">7</span>]  <span class="comment">#选取Dream为缺失样本的Span和Gest值</span></span><br><span class="line">data.pre&lt;-as.matrix(cbind(rep(<span class="number">1</span>,<span class="number">12</span>),data.pre))</span><br><span class="line">q&lt;-pooled$qbar  <span class="comment">#通过拟合回归预测Dream</span></span><br><span class="line">pre&lt;-data.pre%*%q  <span class="comment">#预测结果</span></span><br><span class="line">pre</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##      [,<span class="number">1</span>]</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  -<span class="number">0.155</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2.248</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>      NA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>  <span class="number">0.935</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">24</span>  <span class="number">1.381</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">26</span>  <span class="number">2.226</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">30</span>  <span class="number">2.053</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">31</span>  <span class="number">2.343</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">47</span>  <span class="number">2.237</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">53</span>  <span class="number">1.881</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">55</span>  <span class="number">2.136</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">62</span>  <span class="number">2.338</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&lt;-is.na(sleep$Dream)</span><br><span class="line">sleep$Dream[index]&lt;-pre  <span class="comment">#替代缺失值</span></span><br><span class="line">sleep[index,]</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##    BodyWgt BrainWgt NonD  Dream Sleep Span Gest Pred Exp Danger</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">6654.00</span>   <span class="number">5712.0</span>   NA -<span class="number">0.155</span>   <span class="number">3.3</span> <span class="number">38.6</span>  <span class="number">645</span>    <span class="number">3</span>   <span class="number">5</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>     <span class="number">3.38</span>     <span class="number">44.5</span>   NA  <span class="number">2.248</span>  <span class="number">12.5</span> <span class="number">14.0</span>   <span class="number">60</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>     <span class="number">0.92</span>      <span class="number">5.7</span>   NA     NA  <span class="number">16.5</span>   NA   <span class="number">25</span>    <span class="number">5</span>   <span class="number">2</span>      <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">14</span>  <span class="number">187.10</span>    <span class="number">419.0</span>   NA  <span class="number">0.935</span>   <span class="number">3.1</span> <span class="number">40.0</span>  <span class="number">365</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">24</span>  <span class="number">207.00</span>    <span class="number">406.0</span>   NA  <span class="number">1.381</span>  <span class="number">12.0</span> <span class="number">39.3</span>  <span class="number">252</span>    <span class="number">1</span>   <span class="number">4</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">26</span>   <span class="number">36.33</span>    <span class="number">119.5</span>   NA  <span class="number">2.226</span>  <span class="number">13.0</span> <span class="number">16.2</span>   <span class="number">63</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">30</span>  <span class="number">100.00</span>    <span class="number">157.0</span>   NA  <span class="number">2.053</span>  <span class="number">10.8</span> <span class="number">22.4</span>  <span class="number">100</span>    <span class="number">1</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">31</span>   <span class="number">35.00</span>     <span class="number">56.0</span>   NA  <span class="number">2.343</span>    NA <span class="number">16.3</span>   <span class="number">33</span>    <span class="number">3</span>   <span class="number">5</span>      <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">47</span>    <span class="number">4.29</span>     <span class="number">39.2</span>   NA  <span class="number">2.237</span>  <span class="number">12.5</span> <span class="number">13.7</span>   <span class="number">63</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">53</span>   <span class="number">14.83</span>     <span class="number">98.2</span>   NA  <span class="number">1.881</span>   <span class="number">2.6</span> <span class="number">17.0</span>  <span class="number">150</span>    <span class="number">5</span>   <span class="number">5</span>      <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">55</span>    <span class="number">1.40</span>     <span class="number">12.5</span>   NA  <span class="number">2.136</span>  <span class="number">11.0</span> <span class="number">12.7</span>   <span class="number">90</span>    <span class="number">2</span>   <span class="number">2</span>      <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">62</span>    <span class="number">4.05</span>     <span class="number">17.0</span>   NA  <span class="number">2.338</span>    NA <span class="number">13.0</span>   <span class="number">38</span>    <span class="number">3</span>   <span class="number">1</span>      <span class="number">1</span></span></span><br></pre></td></tr></table></figure>
<h2 id="u5904_u7406_u7F3A_u5931_u503C_u7684_u5176_u4ED6_u65B9_u6CD5"><a href="#u5904_u7406_u7F3A_u5931_u503C_u7684_u5176_u4ED6_u65B9_u6CD5" class="headerlink" title="处理缺失值的其他方法"></a>处理缺失值的其他方法</h2><p>除了mice包，许多R程序包也提供了多重估算函数，因为不同数据类型要求的估计方法不同。</p>
<table>
<thead>
<tr>
<th>R包</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hmisc</td>
<td>包含多种函数，支持简单插补、多重插补和典型变量插补</td>
</tr>
<tr>
<td>mvnmle</td>
<td>对多元正态颁数据中缺失值的最大似然估计</td>
</tr>
<tr>
<td>norm</td>
<td>提供期望最大化算法</td>
</tr>
<tr>
<td>monomvn</td>
<td>可以估计单调多元正态数据的缺失值</td>
</tr>
<tr>
<td>cat</td>
<td>对数线性模型中多元类别型变量的多重插补</td>
</tr>
<tr>
<td>mix</td>
<td>一般位置模型中混合类别型和连续型数据的多重插补</td>
</tr>
<tr>
<td>pan</td>
<td>多元面板数据或聚类的多重插补</td>
</tr>
<tr>
<td>longitudinalData</td>
<td>相关的函数列表，比如对时间序列缺失值进行插补的一系列函数</td>
</tr>
</tbody>
</table>
]]></content>
    <summary type="html">
    <![CDATA[<p>在收集的真实数据中，数据缺失是非常常见的现象，而且会对之后的数据分析产生较大影响，因而缺失值的处理是数据预处理的重要内容之一。基本上，缺失数据处理的流程是，首先判断其模式是否随机，然后找出缺失的原因，最后对缺失值进行处理。</p>
<p>这里主要用到VIM和mice包。并利用VIM包里的sleep数据集。<br>]]>
    
    </summary>
    
      <category term="R" scheme="http://datarting.com/tags/R/"/>
    
      <category term="数据分析" scheme="http://datarting.com/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="数据预处理" scheme="http://datarting.com/tags/%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/"/>
    
      <category term="缺失值" scheme="http://datarting.com/tags/%E7%BC%BA%E5%A4%B1%E5%80%BC/"/>
    
      <category term="数据分析" scheme="http://datarting.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://datarting.com/2016/01/15/hello-world/"/>
    <id>http://datarting.com/2016/01/15/hello-world/</id>
    <published>2016-01-15T12:55:29.000Z</published>
    <updated>2016-01-17T19:08:09.946Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.<br><a id="more"></a></p>
<h2 id="Quick_Start"><a href="#Quick_Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create_a_new_post"><a href="#Create_a_new_post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server"><a href="#Run_server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files"><a href="#Generate_static_files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites"><a href="#Deploy_to_remote_sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.<br>]]>
    
    </summary>
    
      <category term="R" scheme="http://datarting.com/tags/R/"/>
    
      <category term="数据分析" scheme="http://datarting.com/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="数据分析" scheme="http://datarting.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[test]]></title>
    <link href="http://datarting.com/2016/01/15/test/"/>
    <id>http://datarting.com/2016/01/15/test/</id>
    <published>2016-01-15T12:45:29.000Z</published>
    <updated>2016-01-17T19:02:53.105Z</updated>
    <content type="html"><![CDATA[<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com" target="_blank" rel="external">http://rmarkdown.rstudio.com</a>.</p>
<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>
<a id="more"></a>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(cars)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">##      speed           dist       </span></span><br><span class="line"><span class="preprocessor">##  Min.   : <span class="number">4.0</span>   Min.   :  <span class="number">2.00</span>  </span></span><br><span class="line"><span class="preprocessor">##  <span class="number">1</span>st Qu.:<span class="number">12.0</span>   <span class="number">1</span>st Qu.: <span class="number">26.00</span>  </span></span><br><span class="line"><span class="preprocessor">##  Median :<span class="number">15.0</span>   Median : <span class="number">36.00</span>  </span></span><br><span class="line"><span class="preprocessor">##  Mean   :<span class="number">15.4</span>   Mean   : <span class="number">42.98</span>  </span></span><br><span class="line"><span class="preprocessor">##  <span class="number">3</span>rd Qu.:<span class="number">19.0</span>   <span class="number">3</span>rd Qu.: <span class="number">56.00</span>  </span></span><br><span class="line"><span class="preprocessor">##  Max.   :<span class="number">25.0</span>   Max.   :<span class="number">120.00</span></span></span><br></pre></td></tr></table></figure>
<p>You can also embed plots, for example:</p>
<p><img src="/aa_files/figure-html/unnamed-chunk-2-1.png" alt="">\</p>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
<p>哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈<br><img src="http://img4.3lian.com/sucai/img6/230/29.jpg" alt="alt text"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com">http://rmarkdown.rstudio.com</a>.</p>
<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>]]>
    
    </summary>
    
      <category term="R" scheme="http://datarting.com/tags/R/"/>
    
      <category term="数据挖掘" scheme="http://datarting.com/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="数据挖掘" scheme="http://datarting.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
</feed>
